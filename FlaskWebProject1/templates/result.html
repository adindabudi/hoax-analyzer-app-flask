{% extends "layout.html" %}

{% block content %}
<div id="hoax-analyzer" class="step-three input-form">
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading clearfix">
                <h4 class="panel-title pull-left"><strong>Text Input</strong></h4>
                <button href="#text-input" class="btn btn-xs pull-right text-display-toggle" style="background: none;"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> Show</button>
            </div>
            <div class='panel-body' id="text-input" style="display:none">{{result.inputText}}</div>
        </div>

        <hr/>      
        <h4 id="hoax-analyzer"><strong>Analysis Result</strong></h4>
        <center>
            <div id="chart_div"></div>
            <div class="inference-info">{{conclusion}} <b>{{result.conclusion.upper()}}</b></div> 
            <div class="feedback-result-section">
                <p class="help-text">Help us improve the result. </p> <button type="button" class="btn btn-success feedback-button btn-xs" data-toggle="modal" data-target="#result-feedback-modal">Give feedback</button>
            </div>
        </center>
        <div class="disclaimer-message">
            <h5><strong>Disclaimer:</strong></h5>
            <p>The calculations for the Hoax Probability are based on the cross-checking of the top results from search engines. Please check the articles in the references to ensure whether the Hoax Probability is correct.</p>
        </div>
        <hr/>
    </div>

    <div class="col-md-6">
        <h4><strong>References</strong></h4>
        <ul class="list-references list-group">
            {% set i = 1 %}
            {% for reference in result.references %}
                <li class='reference list-group-item'>
                    <b>{{reference.url_base}}</b>
                    <br/>
                    <span class='disclaimer'>probably said it's a</span><span class='{{reference.label}}'>{{reference.label.upper()}}</span>
                    <br/><button type='button' data-id="{i}" class='btn btn-primary reference-button btn-xs' data-toggle='modal' data-target="#reference-feedback-modal-{{i}}">See reference</button>
                </li>
                <div id='reference-feedback-modal-{{i}}' data-id="{{i}}" class='modal fade' role='dialog'>
                    <div class='modal-dialog'>
                        <div class='modal-content reference-feedback-modal'>
                            <div class='modal-header'>
                                <button type='button' class='close' data-dismiss='modal'>&times;</button>
                                <h4 class='modal-title'><strong>Reference Feedback</strong></h4>
                            </div>
                            <div class='modal-body'>
                                <div class='col-md-6'>
                                    <h5 style='display: inline;'><strong>Reference text</strong></h5>
                                    <a class='pull-right source-link' target='_blank' href="{{reference.url}}">Source</a>
                                    <p class='well reference-text'>{{reference.text}}</p>
                                </div>
                                <div class='col-md-6'>
                                    <center>
                                        <p><strong>Is the reference relevant to the text input?</strong></p>
                                        <label class='radio-inline' for='radios-4'>
                                            <input name='relevant-radios' class='radios-4' value='Relevant' checked='checked' type='radio'>Relevant
                                        </label> 
                                        <label class='radio-inline' for='radios-5'>
                                            <input name='relevant-radios' class='radios-5' value='Not Relevant' type='radio'>Not Relevant
                                        </label><br/>
                                        <div class='reference-label-question' style='display: none'>
                                            <br/>
                                            <p><strong>What does the reference say about the text?</strong></p>
                                            <label class='radio-inline' for='radios-6'>
                                                <input name='reference-label-radios' id='radios-6' value='Fact' checked='checked' type='radio'>Fact
                                            </label> 
                                            <label class='radio-inline' for='radios-7'>
                                                <input name='reference-label-radios' id='radios-7' value='Hoax' type='radio'>Hoax
                                            </label>
                                            <textarea id='feedback' class='form-control textarea searchinput reference-feedback-reason' name='reference-feedback-reason' rows='2' placeholder='Tell us the reason (optional)'></textarea>
                                        </div>
                                        <button id='feedback' type='button' data-id="{{reference.id}}" class='btn btn-default btn-sm reference-feedback-button'>Send</button>
                                    </center>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% set i = i + 1 %}                
            {% endfor %}
        </ul>
        <hr/>
        <div class="row">
            <div class="col-md-5 col-xs-5"><b>Share with</b></div>
            <div class="col-md-2 col-xs-2 fb-share-button" data-href="http://hoax-analyzer.azurewebsites.net/">
                <a class="fb-xfbml-parse-ignore fb-popup" href="#"><img id="share_button" src="/static/img/facebook.png"/></a>
            </div>
            <div class="col-md-2 col-xs-2"><a class="twitter-share-button twitter-popup" href="#"><img src="/static/img/twitter.png"/></a></div>
            <div class="col-md-2 col-xs-2"><a class="link-share-button" href="#"><img src="/static/img/link.png"/></a></div>
        </div>
        <hr/>
        <div class="row">
            <center>
                <a id="hoax-analyzer" class="btn btn-default btn-sm" aria-label="Left Align" style="margin-top: 0;" href="/">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span> Analyze other text
                </a>
            </center>
        </div>
    </div>
</div>

<div id="result-feedback-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title"><strong>Analysis Result Feedback</strong></h4>
            </div>
            <div class="modal-body">
                <center>
                    <p><strong>What the analysis result should be?</strong></p>
                    <label class="radio-inline" for="radios-0">
                        <input name="is-know-radios" id="radios-0" value="Fact" type="radio">Fact
                    </label> 
                    <label class="radio-inline" for="radios-1">
                        <input name="is-know-radios" id="radios-1" value="Hoax" type="radio">Hoax
                    </label>
                    <label class="radio-inline" for="radios-2">
                        <input name="is-know-radios" id="radios-2" value="Idk" checked="checked" type="radio">Don't know
                    </label>
                    <br/>
                    <div id="result-label-question">
                        <textarea id="feedback" class="form-control textarea searchinput result-feedback-reason" name="result-feedback-reason" rows="2" placeholder="Tell us the reason (optional)"></textarea>
                    </div>
                    <button id="feedback" type="button" class="btn btn-default btn-sm" onclick="callResultFeedbackAPI('{{result.id}}')">Send</button>
              </center>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/scripts/results.js"></script>
<script>
    fact_p = {{result.scores[1]}};
    hoax_p = {{result.scores[2]}};
    unkn_p = {{result.scores[3]}};
    totalp = fact_p + hoax_p + unkn_p;

    chart_data = [['Fact', fact_p], ['Hoax', hoax_p], ['Unknown', unkn_p]];
    drawChart();
</script>
{% endblock %}